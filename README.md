
# 2021년 K-인공지능 제조데이터 분석 경진대회

### 목차
[대회 개요](#대회-개요) <br>
[데이터 특징](#데이터-특징) <br>
[문제 정의](#문제-정의) <br>
[모델링](#모델링) <br>
[분석 결과 해석](#분석-결과-해석) <br>
[코드 설명](#코드-설명) <br>


<br>
<br>

## 대회 개요

#### 주최&주관
주최 : 중소벤처기업부 / 주관: 스마트제조혁신추진단

#### 목적
인공지능 중소벤처 제조 플랫폼(KAMP) 내 등재된 제조 AI 데이터셋을 활용, 중소 제조기업이 직면할 수 있는 공통문제를 해결 또는 개선할 수 있는 우수한 인공지능 분석모델 개발

<br>
<br>

## 데이터 특징
- 주요 특징으로는 라벨 데이터 부족, 데이터 불균형, 제품 유형차이 존재
- 라벨 데이터 약 5,000건 / 비 라벨 데이터 약 80만건 → 비라벨 데이터가 150배 많음
- 라벨 데이터에서 불량 건수는 약 60건 → 양품: 불량 = 80:1
- 비라벨 데이터에만 포함되어 있는 제품 다수 존재 → 다품종 소량 생산 의미. 제품 정보를 모델에 사용하기 어려움
- 라벨 데이터와 비라벨 데이터의 분포 상이 → 두 데이터 모두 활용해야 함

<br>
<br>

## 문제 정의

#### 제조업 분야의 데이터 분석 목표
- 본 대회의 경우 스마트 공장 level 2에 해당하는 유형
- 라벨 데이터를 통해 불량과 제품의 현황 파악과 원인을 어느 정도 파악할 수 있겠지만 원인 분석과 품질 개선 방안에 대해 알기 어려울 것이라고 가정
- 현 상황에서 level 3,4로 진입하기 위해서 공정 상태에 따른 품질 예측(Prediction)과 원인 파악(Diagnosis) 분석이 필요하다고 판단

#### 중소 스마트 공장 데이터 문제점
- 충분한 데이터셋 확보의 어려움 : 다품종 소량 생산 및 생산 기간, 공정 장비의 잦은 변동
- 근본적인 분석의 어려움 : 기본 분석법은 통계적으로 유의한 인자만 산출하기 때문에 실질적 공정 개선에 대한 의구심 존재
    
#### 분석 목표

1. 불충분한 데이터셋을 통한 예측 모델 생성 ⇒ 불량 조기 발견 & 품질 검사 횟수 감소 
    
    양품, 불량의 불균형과 학습 데이터에 포함되지 않은 장비, 제품의 데이터도 예측하는 방안 마련
    
2. 근본적인 원인 분석을 통한 정량적 분석 기반 마련 ⇒ 불량 발생 원인 제거 & 품질 검사 시간 감소
    
    불량에 대한 주요 설명변수 도출과 이들의 관계를 파악하여 근본 원인을 설명하는 방안 마련
    

<br>
<br>

## 모델링

#### 1. 예측 모델링


|순서	|방법	|사용 알고리즘	|근거|
|-----|------|-----------|-----|
|1	|라벨+비라벨 데이터를 활용한 비지도 학습|	오토 인코더	|전이학습|
|2	|학습된 인코더에 분류 레이어 추가해 지도 학습 진행|	-	|자기지도 학습, Fine-tunning 개념 차용|
|3	|가성 알람(False Alarm)을 줄이기 위해 불량 예측 데이터에 대한 추가 모델링|	XGBoost	|오탐지 재추론|

<img width="1055" alt="image" src="https://user-images.githubusercontent.com/30097727/227458974-0739fedd-cc51-4b11-92b0-9909d8c74aa5.png">



#### 2. 불량 원인 분석
- 불량에 대한 주요 원인 분석
  - 예측 모델이 Black-box 모델이므로 직접적 원인 분석이 쉽지 않음
  - 때문에 근사하는 모델을 이용해 기존 모델을 해석하는 Post-hoc 해석 기법을 사용한 SHAP을 활용해 주요 변수 산출
- 근본 원인 분석
  - 모델링으로 산출한 주요 변수의 공정 단계의 선후 관계를 이용해 인과 관계를 표현
  - 고도화된 근본원인 분석이 다수 있지만, 데이터 확보의 어려움이 있는 중소 제조업의 현실을 감안하여 실제 적용할 수 있는 방법론으로 판단
<img width="352" alt="image" src="https://user-images.githubusercontent.com/30097727/227458792-0c78f9c0-1c13-48c4-9776-4281121779a0.png">



<br>
<br>

## 분석 결과 해석
#### 모델 검증 방법
- 라벨 데이터를 활용하여 불량에 대한 비율은 유지한 채 학습/검증/테스트 데이터로 분할 → 테스트 데이터의 예측 성능을 측정

| 학습 데이터 | 2,563 |
| --- | --- |
| 검증 데이터 | 1,099 |
| 테스트 데이터 | 1,570 |

- 성능지표 : False Negative 비율 
(실제 공정에서 이상을 놓치는 경우, 모델을 신뢰하지 못해 사용할 수 없으므로 해당 성능 지표 0%를 목표로 함)

<br>

#### 불량 예측 모델
불량 예측 과정은 Part1, Part2로 나눠서 순차적으로 진행
- Part1
  - 반지도 학습으로 훈련된 모델을 이용해 1차 불량 예측 수행 
  - False Negative (불량을 양품으로 판정한 경우) : 0건
  - False Positive (양품을 불량으로 판정한 경우) : 900건
  ⇒ 모델이 실제 이상을 놓치는 경우는 없지만 FP가 높은경우 사용상에 불편을 야기하므로 최대한 해당 경우를 줄이고자 함
  ![3-5](https://user-images.githubusercontent.com/30097727/227458205-e0a2e1f7-7cc6-4ed5-82f4-00faf0b22221.png)

- Part 2 
  - PART1에서 불량으로 판정한 데이터만 활용해 추가 모델링
  - False Positive : 900건 → 648건 (약 40% 감소)
  ⇒ 여전히 실제 이상을 놓치지 않고 품질 검사 시간 단축할 수 있는 계기 마련
  ![3-6](https://user-images.githubusercontent.com/30097727/227458272-961f4a8b-b384-4a62-8029-87cbc87cf4ff.png)

💡활용 : 생산 데이터를 이용해 불량을 미리 예측해 검수량을 과반으로 줄일 수 있다면 수율 샹항에 큰 기여를 할 것으로 기대함.

<br>

#### 불량 주요 원인 분석
실제 공정에서 원인인자 분석의 목적은 불량 유형별 원인을 파악하여 조치하고 재발을 방지하는 것. 이를 위해 본 분석에서는 라벨 데이터의 불량 종류 정보를 이용함
<img width="1039" alt="image" src="https://user-images.githubusercontent.com/30097727/227459151-c7e73b6a-8fc8-4f36-a9e8-52d732f52c3b.png">

<br>

#### 불량 근본 원인 분석
주요 원인 인자의 이전 공정 인자들과의 관계를 도출하여 근본 원인 인자를 탐색. 아래 그림은 산출한 주요 인자와 이와 관련된 인자들을 시각화한 결과임.
<img width="1051" alt="image" src="https://user-images.githubusercontent.com/30097727/227458619-9bd60b03-c8fc-4ab2-9eaa-1156c591272c.png">


💡활용 : 엔지니어는 해당 결과를 토대로 실제 제어 가능한 인자를 살펴보고 관계를 조절하여 불량 개선을 수행할 수 있음



<br>
<br>

## 코드 설명

1. create_datasets.ipynb : 데이터 전처리 및 학습을 위한 데이터세트 생성
2. autoencoder.ipynb : 오토 인코더를 통한 특징 추출
3. classification.ipynb : 인코더에 분류레이어를 추가하여 지도 학습 진행 및 추가 분류 모델링
4. root_causation.ipynb : 불량 원인 분석
